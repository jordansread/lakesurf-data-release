
target_default: 1_spatial

packages:
  - yaml
  - dplyr
  - meddle
  - readr
  - rgdal
  - httr
  - lwgeom
  - stringr
  - sf


sources:
  - src/spatial_utils.R
  - src/file_utils.R
  - src/group_utils.R

targets:
  1_spatial:
    depends:
      - out_data/lake_metadata.csv
      - out_data/lake_surface_temp_obs.csv


  us_counties_sf:
    command: fetch_zip_url_sf(I('https://www2.census.gov/geo/tiger/GENZ2018/shp/cb_2018_us_county_5m.zip'),
      layer_name = I('cb_2018_us_county_5m'))

  spatial_metadata:
    command: extract_feature(modeled_centroids_sf)

  modeled_centroids_sf:
    command: sf_centroid_metadata('out_data/lake_metadata.csv')

# make a grid that doesn't depend on the centroids
  release_grid_sf:
    command: generate_group_rects()


  weather_centroids:
    command: ldas_centroid_lat_lon(x0 = I(-124.9375), y0 = I(25.0625), x_num = I(464), y_num = I(224), cell_res = I(0.125))

#  cell_id_groups:
#    command: assign_group_id(cell_centroids, release_grid_sf, use_col = I('cell_id'))
  # next will need to add group to this...
  metadata_tbl:
    command: build_metadata(target_name, 'in_data/surface_lake_metadata_file.csv', release_grid_sf, weather_centroids)

  out_data/lake_metadata.csv:
    command: subset_write(target_name, metadata_tbl, remove_cols = I(c('x','y')))

  out_data/lake_surface_temp_obs.csv:
    command: convert_feather_file(target_name, feather_fl = 'in_data/surface_lake_temp_daily.feather')

